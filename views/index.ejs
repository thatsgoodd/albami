<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>알밤이</title>
    <script>
      function deleteSpending(id) {
        if (confirm('정말 삭제하시겠습니까?')) {
          fetch(`/deleteSpending/${id}`, {
            method: 'DELETE',
          })
            .then(response => response.text())
            .then(result => {
              alert(result);
              location.reload();
            })
            .catch(error => {
              console.error('Error deleting data:', error);
              alert('삭제 실패');
            });
        }
      }
    </script>
</head>
<body style="background: #EAEAEA;">

    <div style="width: 1450px; margin: 40px auto 0 auto;">
        <img src="/albamiLogo.png" alt="알밤이 로고" style="width:300px; margin-left: 600px;">
        <div>
            <div style="width: 85%; display: inline-block; margin-left: 30px;">
                <h1>급여 지출 계획서</h1>
                <p style="color: #8C8C8C">입력하신 아르바이트 정보에 따라 계산된 예상 급여를 기준으로 하여 산정됩니다.</p>
            </div>
            <div style="display: inline-block;">
                <p style="font-weight: bold">받은 급여 <%= totalIncome.toLocaleString() %></p>
                <p style="font-weight: bold">예상 지출 <%= totalAmount.toLocaleString() %></p>
            </div>
        </div>

        <div style="width: 1445px; height: 600px; background: white; border-radius: 20px;">
            <div style="font-weight: bold; font-size: large">
                <p style="display: inline-block; margin-left: 150px; margin-right: 290px;">지출명</p>
                <p style="display: inline-block; margin-right: 140px;">지출 일자</p>
                <p style="display: inline-block; margin-right: 240px;">지출 카테고리</p>
                <p style="display: inline-block; ">지출 금액(원)</p>
            </div>
            <hr style="margin-top: 0;">

            <div>
                <% function formatDate(date) {
                    const d = new Date(date);
                    const days = ['일', '월', '화', '수', '목', '금', '토'];
                    const dayName = days[d.getDay()];
                    const month = (d.getMonth() + 1).toString().padStart(2, '0');
                    const day = d.getDate().toString().padStart(2, '0');
                    const year = d.getFullYear();
                    return `${year}-${month}-${day} (${dayName})`;
                } %>
                <% data.forEach(item => { %>
                    <div>
                        <p style="display: inline-block; width: 100px; margin-left: 40px;"><%= item.fix === 'fixed' ? '고정' : (item.fix === 'nonfixed' ? '미고정' : '') %></p>
                        <p style="display: inline-block; width: 350px;"><%= item.title %></p>
                        <p style="display: inline-block; width: 218px;" ><%= formatDate(item.date) %></p>
                        <p style="display: inline-block; width: 360px;"><%= item.category %></p>
                        <p style="display: inline-block; width: 232px;"><%= item.amount.toLocaleString() %></p>
                        <button onclick="deleteSpending(<%= item.id %>)" style="color: #EB7979;">삭제</button>
                    </div>
                <% }) %>
            </div>

            <form action="/spendingProc" method="post" style="margin-top: 10px;">
                <select name="fix" onchange="this" style="margin-left: 40px;">
                    <option value="fixed">고정</option>
                    <option value="nonfixed">미고정</option>
                </select>
                <input type="text" name="title" placeholder="지출명을 입력해주세요." style="display: inline-block; width: 300px; margin-left: 35px; margin-right: 40px" required />
                <input type="date" name="date" style="margin-right: 106px;" required />
                <input type="text" name="category" placeholder="지출 카테고리를 입력해주세요." style="display: inline-block; width: 200px; margin-right: 146px;" />
                <input type="text" name="amount" placeholder="숫자만 입력하세요." style="display: inline-block; margin-right: 60px;" required />
                <button style="color: #2C6A9C;">저장</button>
            </form>
        </div>

        <div style="float: right; margin-right: 30px; color: #704D41;">
            <p style="display: inline-block; margin-right: 5px;">현재 잔여 급여</p>
            <h1 style="display: inline-block;"><%= remainingIncome.toLocaleString() %></h1>
        </div>

    </div>

</body>
</html>

